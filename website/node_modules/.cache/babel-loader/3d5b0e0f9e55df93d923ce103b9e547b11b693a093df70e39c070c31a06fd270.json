{"ast":null,"code":"import React,{useState,useEffect}from'react';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";export function FetchAndDeleteFiles(){const[config,setConfig]=useState({domain:'',port:''});const[htmlResponse,setHtmlResponse]=useState(null);const[links,setLinks]=useState([]);const[error,setError]=useState(null);const[loading,setLoading]=useState(true);const[deleting,setDeleting]=useState(false);useEffect(()=>{const fetchConfig=async()=>{try{const response=await fetch(\"/file.conf\");if(!response.ok){throw new Error('Impossible de charger la configuration.');}const configText=await response.text();const domainMatch=configText.match(/domain\\s+(\\S+)/);const portMatch=configText.match(/listen\\s+(\\d+)/);if(!domainMatch||!portMatch){throw new Error('Domaine ou port introuvable dans la configuration.');}setConfig({domain:domainMatch[1],port:portMatch[1]});}catch(err){setError(err.message);}};fetchConfig();},[]);useEffect(()=>{const fetchFiles=async()=>{if(!config.domain||!config.port)return;try{const response=await fetch(`http://${config.domain}:${config.port}/delete`,{method:'GET'});console.log(config.domain);console.log(config.port);if(!response.ok){throw new Error('Erreur lors de la récupération des fichiers.');}const htmlContent=await response.text();setHtmlResponse(htmlContent);// Analyser le HTML pour extraire les liens\nconst linksArray=extractLinksFromHTML(htmlContent);setLinks(linksArray);}catch(err){setError(err.message);}finally{setLoading(false);}};fetchFiles();},[config]);const extractLinksFromHTML=htmlContent=>{const parser=new DOMParser();const doc=parser.parseFromString(htmlContent,'text/html');const links=doc.querySelectorAll('a');console.log(\"LINKS = \");console.log(links);return Array.from(links).filter(link=>link.getAttribute('href')).map(link=>({href:link.getAttribute('href'),name:link.textContent}));};const handleDelete=async path=>{if(deleting)return;// éviter les suppressions multiples en parallèle\nsetDeleting(true);try{const response=await fetch(`http://${config.domain}:${config.port}/delete/${path}`,{method:'DELETE',headers:{'Content-Type':'application/json'}});if(!response.ok){throw new Error('Erreur lors de la suppression du fichier.');}// Rafraîchir la liste après suppression\nalert('Fichier ou dossier supprimé avec succès');// Refaites le fetch des fichiers après suppression si nécessaire\nsetLinks(links.filter(link=>link.href!==path));}catch(err){setError(err.message);}finally{setDeleting(false);}};if(error)return/*#__PURE__*/_jsxs(\"p\",{children:[\"Erreur : \",error]});if(loading)return/*#__PURE__*/_jsx(\"p\",{children:\"Chargement des fichiers...\"});return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Liste des fichiers et r\\xE9pertoires\"}),links.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"Aucun fichier ou r\\xE9pertoire trouv\\xE9.\"}):/*#__PURE__*/_jsx(\"ul\",{children:links.map((link,index)=>/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"a\",{href:`http://${config.domain}:${config.port}/`+link.href.substr(2),target:\"_blank\",rel:\"noopener noreferrer\",children:link.name}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete(link.href),children:\"Supprimer\"})]},index))})]});}","map":{"version":3,"names":["React","useState","useEffect","jsxs","_jsxs","jsx","_jsx","FetchAndDeleteFiles","config","setConfig","domain","port","htmlResponse","setHtmlResponse","links","setLinks","error","setError","loading","setLoading","deleting","setDeleting","fetchConfig","response","fetch","ok","Error","configText","text","domainMatch","match","portMatch","err","message","fetchFiles","method","console","log","htmlContent","linksArray","extractLinksFromHTML","parser","DOMParser","doc","parseFromString","querySelectorAll","Array","from","filter","link","getAttribute","map","href","name","textContent","handleDelete","path","headers","alert","children","length","index","substr","target","rel","onClick"],"sources":["/tmp/Webserv/website/src/delete_file.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\n\nexport function FetchAndDeleteFiles() {\n    const [config, setConfig] = useState({ domain: '', port: '' });\n    const [htmlResponse, setHtmlResponse] = useState(null);\n    const [links, setLinks] = useState([]);\n    const [error, setError] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [deleting, setDeleting] = useState(false);\n\n    useEffect(() => {\n        const fetchConfig = async () => {\n            try {\n                const response = await fetch(\"/file.conf\");\n                if (!response.ok) {\n                    throw new Error('Impossible de charger la configuration.');\n                }\n                const configText = await response.text();\n                const domainMatch = configText.match(/domain\\s+(\\S+)/);\n                const portMatch = configText.match(/listen\\s+(\\d+)/);\n\n                if (!domainMatch || !portMatch) {\n                    throw new Error('Domaine ou port introuvable dans la configuration.');\n                }\n\n                setConfig({ domain: domainMatch[1], port: portMatch[1] });\n            } catch (err) {\n                setError(err.message);\n            }\n        };\n\n        fetchConfig();\n    }, []);\n\n    useEffect(() => {\n        const fetchFiles = async () => {\n            if (!config.domain || !config.port) return;\n\n            try {\n                const response = await fetch(`http://${config.domain}:${config.port}/delete`, {\n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t  });\n\t\t\t\tconsole.log(config.domain);\n\t\t\t\tconsole.log(config.port);\n                if (!response.ok) {\n                    throw new Error('Erreur lors de la récupération des fichiers.');\n                }\n\n                const htmlContent = await response.text();\n                setHtmlResponse(htmlContent);\n\n                // Analyser le HTML pour extraire les liens\n                const linksArray = extractLinksFromHTML(htmlContent);\n                setLinks(linksArray);\n            } catch (err) {\n                setError(err.message);\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        fetchFiles();\n    }, [config]);\n\n    const extractLinksFromHTML = (htmlContent) => {\n        const parser = new DOMParser();\n        const doc = parser.parseFromString(htmlContent, 'text/html');\n        const links = doc.querySelectorAll('a');\n\n\t\tconsole.log(\"LINKS = \");\n\t\tconsole.log(links);\n        return Array.from(links)\n            .filter(link => link.getAttribute('href'))\n            .map(link => ({\n                href: link.getAttribute('href'),\n                name: link.textContent,\n            }));\n    };\n\n    const handleDelete = async (path) => {\n        if (deleting) return; // éviter les suppressions multiples en parallèle\n        setDeleting(true);\n\n        try {\n            const response = await fetch(`http://${config.domain}:${config.port}/delete/${path}`, {\n                method: 'DELETE',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n            });\n\n            if (!response.ok) {\n                throw new Error('Erreur lors de la suppression du fichier.');\n            }\n\n            // Rafraîchir la liste après suppression\n            alert('Fichier ou dossier supprimé avec succès');\n            // Refaites le fetch des fichiers après suppression si nécessaire\n            setLinks(links.filter(link => link.href !== path));\n        } catch (err) {\n            setError(err.message);\n        } finally {\n            setDeleting(false);\n        }\n    };\n\n    if (error) return <p>Erreur : {error}</p>;\n    if (loading) return <p>Chargement des fichiers...</p>;\n\n    return (\n        <div>\n            <h1>Liste des fichiers et répertoires</h1>\n            {links.length === 0 ? (\n                <p>Aucun fichier ou répertoire trouvé.</p>\n            ) : (\n                <ul>\n                    {links.map((link, index) => (\n                        <li key={index}>\n                            <a href={`http://${config.domain}:${config.port}/` + link.href.substr(2)} target=\"_blank\" rel=\"noopener noreferrer\">\n                                {link.name}\n                            </a>\n                            <button onClick={() => handleDelete(link.href)}>\n                                Supprimer\n                            </button>\n                        </li>\n                    ))}\n                </ul>\n            )}\n        </div>\n    );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}