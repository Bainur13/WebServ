{"ast":null,"code":"import React,{useState,useEffect}from'react';import{NavBar}from'./navbar.js';import{Footer}from'./footer.js';import'./assets/styles/delete_file.css';import{isThemeSet}from'./choose_theme';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const isLightTheme=isThemeSet();export function FetchAndDeleteFiles(){const[config,setConfig]=useState({domain:'',port:''});const[links,setLinks]=useState([]);const[error,setError]=useState(null);const[loading,setLoading]=useState(true);const[deleting,setDeleting]=useState(false);useEffect(()=>{const fetchConfig=async()=>{try{const response=await fetch(\"/file.conf\");if(!response.ok){throw new Error('Impossible de charger la configuration.');}const configText=await response.text();const domainMatch=configText.match(/domain\\s+(\\S+)/);const portMatch=configText.match(/listen\\s+(\\d+)/);if(!domainMatch||!portMatch){throw new Error('Domaine ou port introuvable dans la configuration.');}setConfig({domain:domainMatch[1],port:portMatch[1]});}catch(err){setError(err.message);}};fetchConfig();},[]);useEffect(()=>{const fetchFiles=async()=>{if(!config.domain||!config.port)return;try{const response=await fetch(`http://${config.domain}:${config.port}/delete`,{method:'GET'});console.log(config.domain);console.log(config.port);if(!response.ok){throw new Error('Erreur lors de la récupération des fichiers.');}const htmlContent=await response.text();const linksArray=extractLinksFromHTML(htmlContent);setLinks(linksArray);}catch(err){setError(err.message);}finally{setLoading(false);}};fetchFiles();},[config]);const extractLinksFromHTML=htmlContent=>{const parser=new DOMParser();const doc=parser.parseFromString(htmlContent,'text/html');const links=doc.querySelectorAll('a');return Array.from(links).filter(link=>link.getAttribute('href')).map(link=>({href:link.getAttribute('href'),name:link.textContent}));};const handleDelete=async path=>{if(deleting)return;setDeleting(true);try{const response=await fetch(`http://${config.domain}:${config.port}/delete/${path}`,{method:'DELETE',headers:{'Content-Type':'application/json'}});if(!response.ok){throw new Error('Erreur lors de la suppression du fichier.');}alert('Fichier ou dossier supprimé avec succès');setLinks(links.filter(link=>link.href!==path));}catch(err){setError(err.message);}finally{setDeleting(false);}};if(error){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(NavBar,{}),/*#__PURE__*/_jsx(\"main\",{id:isLightTheme?'deleteFileMainLight':'deleteFileMain',children:/*#__PURE__*/_jsxs(\"p\",{children:[\"Error : \",error]})}),/*#__PURE__*/_jsx(Footer,{})]});}if(loading){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(NavBar,{}),/*#__PURE__*/_jsxs(\"main\",{id:isLightTheme?'deleteFileMainLight':'deleteFileMain',children:[/*#__PURE__*/_jsx(\"p\",{children:\"Loading files...\"}),\";\"]}),/*#__PURE__*/_jsx(Footer,{})]});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(NavBar,{}),/*#__PURE__*/_jsxs(\"main\",{id:isLightTheme?'deleteFileMainLight':'deleteFileMain',children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Files and directory list\"}),links.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No file or directory found\"}):/*#__PURE__*/_jsx(\"div\",{children:links.map((link,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"fileCard\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"p\",{className:\"fetchedFileName\",children:link.name})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{className:isLightTheme?'deleteBtnLight':'deleteBtn',onClick:()=>handleDelete(link.href),children:\"Delete\"})})]}))})]}),/*#__PURE__*/_jsx(Footer,{})]});}","map":{"version":3,"names":["React","useState","useEffect","NavBar","Footer","isThemeSet","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","isLightTheme","FetchAndDeleteFiles","config","setConfig","domain","port","links","setLinks","error","setError","loading","setLoading","deleting","setDeleting","fetchConfig","response","fetch","ok","Error","configText","text","domainMatch","match","portMatch","err","message","fetchFiles","method","console","log","htmlContent","linksArray","extractLinksFromHTML","parser","DOMParser","doc","parseFromString","querySelectorAll","Array","from","filter","link","getAttribute","map","href","name","textContent","handleDelete","path","headers","alert","children","id","length","index","className","onClick"],"sources":["/home/udumas/repo/fifth_circle/WebServ/website/src/delete_file.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { NavBar } from './navbar.js';\nimport { Footer } from './footer.js';\nimport './assets/styles/delete_file.css'\nimport {isThemeSet} from './choose_theme';\n\n\nconst isLightTheme = isThemeSet();\n\nexport function FetchAndDeleteFiles() {\n    const [config, setConfig] = useState({ domain: '', port: '' });\n    const [links, setLinks] = useState([]);\n    const [error, setError] = useState(null);\n    const [loading, setLoading] = useState(true);\n    const [deleting, setDeleting] = useState(false);\n\n    useEffect(() => {\n        const fetchConfig = async () => {\n            try {\n                const response = await fetch(\"/file.conf\");\n                if (!response.ok) {\n                    throw new Error('Impossible de charger la configuration.');\n                }\n                const configText = await response.text();\n                const domainMatch = configText.match(/domain\\s+(\\S+)/);\n                const portMatch = configText.match(/listen\\s+(\\d+)/);\n\n                if (!domainMatch || !portMatch) {\n                    throw new Error('Domaine ou port introuvable dans la configuration.');\n                }\n\n                setConfig({ domain: domainMatch[1], port: portMatch[1] });\n            } catch (err) {\n                setError(err.message);\n            }\n        };\n\n        fetchConfig();\n    }, []);\n\n    useEffect(() => {\n        const fetchFiles = async () => {\n            if (!config.domain || !config.port) return;\n\n            try {\n                const response = await fetch(`http://${config.domain}:${config.port}/delete`, {\n\t\t\t\t\tmethod: 'GET',\n\t\t\t\t  });\n\t\t\t\tconsole.log(config.domain);\n\t\t\t\tconsole.log(config.port);\n                if (!response.ok) {\n                    throw new Error('Erreur lors de la récupération des fichiers.');\n                }\n\n                const htmlContent = await response.text();\n\n                const linksArray = extractLinksFromHTML(htmlContent);\n                setLinks(linksArray);\n            } catch (err) {\n                setError(err.message);\n            } finally {\n                setLoading(false);\n            }\n        };\n\n        fetchFiles();\n    }, [config]);\n\n    const extractLinksFromHTML = (htmlContent) => {\n        const parser = new DOMParser();\n        const doc = parser.parseFromString(htmlContent, 'text/html');\n        const links = doc.querySelectorAll('a');\n\n        return Array.from(links)\n            .filter(link => link.getAttribute('href'))\n            .map(link => ({\n                href: link.getAttribute('href'),\n                name: link.textContent,\n            }));\n    };\n\n    const handleDelete = async (path) => {\n        if (deleting) return;\n        setDeleting(true);\n\n        try {\n            const response = await fetch(`http://${config.domain}:${config.port}/delete/${path}`, {\n                method: 'DELETE',\n                headers: {\n                    'Content-Type': 'application/json',\n                }\n            });\n\n            if (!response.ok) {\n                throw new Error('Erreur lors de la suppression du fichier.');\n            }\n\n            alert('Fichier ou dossier supprimé avec succès');\n            setLinks(links.filter(link => link.href !== path));\n        } catch (err) {\n            setError(err.message);\n        } finally {\n            setDeleting(false);\n        }\n    };\n\n    if (error)\n\t{\n\t\treturn (\n\t\t\t<>\n\t\t\t<NavBar />\n\t\t\t<main id={isLightTheme ? 'deleteFileMainLight' : 'deleteFileMain'}>\n\t\t\t\t<p>Error : {error}</p>\n\t\t\t</main>\n\t\t\t<Footer />\n\t\t\t</>\n\t\t)\n\t}\n    if (loading)\n\t{\n\t\treturn (\n\t\t\t<>\n\t\t\t<NavBar />\n\t\t\t<main id={isLightTheme ? 'deleteFileMainLight' : 'deleteFileMain'}>\n\t\t\t\t<p>Loading files...</p>;\n\t\t\t</main>\n\t\t\t<Footer />\n\t\t\t</>\n\t\t)\n\t}\n\n    return (\n\t\t<>\n\t\t<NavBar />\n\t\t<main id={isLightTheme ? 'deleteFileMainLight' : 'deleteFileMain'}>\n\t\t\t<h1>Files and directory list</h1>\n\t\t\t{links.length === 0 ? (\n\t\t\t\t<p>No file or directory found</p>\n\t\t\t) : (\n\t\t\t\t<div>\n\t\t\t\t{links.map((link, index) => (\n\t\t\t\t\t\t<div className='fileCard'>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<p className='fetchedFileName'>{link.name}</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<button className={isLightTheme ? 'deleteBtnLight' : 'deleteBtn'} onClick={() => handleDelete(link.href)}>\n\t\t\t\t\t\t\t\t\tDelete\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t))}\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</main>\n\t\t<Footer />\n\t\t</>\n    );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}